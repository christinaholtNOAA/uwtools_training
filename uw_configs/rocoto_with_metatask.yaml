user:
  account: zrtrr
workflow:
  attrs:
    realtime: false
    scheduler: slurm
  cycledef:
    - attrs:
        group: cold_start_cycle
      spec: 202508271200 202508271200 01:00:00
    - attrs:
        group: prod
      spec: 202508271300 202508271300 01:00:00
  entities:
    ACCOUNT: "{{ user.account }}"
    LOGDIR: "{{ user.expt_dir}}/log"
  log:
    value: "{{ user.expt_dir }}/workflow.log"
  tasks:
    task_prepare_ics:
      attrs:
        cycledefs: cold_start_cycle
      account: "&ACCOUNT;"
      command:
        cyclestr:
          value: uw chgres_cube run --cycle @Y-@m-@dT@H --leadtime 0 -c {{ user.uw_training }}/uw_configs/prepare_bcs.yaml --key-path make_ics
      join:
        cyclestr:
          value: '&LOGDIR;/{{ jobname }}_@Y@m@d@H.log'
      nodes: "{{ make_ics.chgres_cube.execution.batchargs.nodes }}:ppn={{ make_ics.chgres_cube.execution.batchargs.tasks_per_node }}"
      walltime: "{{ make_ics.chgres_cube.execution.batchargs.walltime }}"
    metatask_prepare_lbcs:
      var:
        LEADTIME: '{% for fh in range(0, 6) %}{{ "%d " % fh }}{% endfor %}'
      task_prepare_ics_#LEADTIME#:
        attrs:
          cycledefs: cold_start_cycle
        account: "&ACCOUNT;"
        command:
          cyclestr:
            value: 'uw chgres_cube run --cycle @Y-@m-@dT@H --leadtime #LEADTIME# -c {{ user.uw_training }}/uw_configs/prepare_bcs.yaml --key-path make_lbcs'
        join:
          cyclestr:
            value: '&LOGDIR;/{{ jobname }}_@Y@m@d@H.log'
        nodes: "{{ make_lbcs.chgres_cube.execution.batchargs.nodes }}:ppn={{ make_lbcs.chgres_cube.execution.batchargs.tasks_per_node }}"
        walltime: "{{ make_lbcs.chgres_cube.execution.batchargs.walltime }}"

